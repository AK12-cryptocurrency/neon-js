<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Basic - Invoking a Smart Contract · neon-js</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;This is a guide to use the &lt;code&gt;doInvoke&lt;/code&gt; method.If you have read &lt;code&gt;Basic - Sending Assets&lt;/code&gt;, then this should feel familiar.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Basic - Invoking a Smart Contract · neon-js"/><meta property="og:type" content="website"/><meta property="og:url" content="http://cityofzion.io/neon-js/index.html"/><meta property="og:description" content="&lt;p&gt;This is a guide to use the &lt;code&gt;doInvoke&lt;/code&gt; method.If you have read &lt;code&gt;Basic - Sending Assets&lt;/code&gt;, then this should feel familiar.&lt;/p&gt;
"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/neon-js/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://unpkg.com/@cityofzion/neon-js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><link rel="stylesheet" href="/neon-js/css/main.css"/></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/neon-js/en"><img class="logo" src="/neon-js/img/logo.svg" alt="neon-js"/><h2 class="headerTitleWithLogo">neon-js</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/neon-js/docs/en/installation.html" target="_self">Docs</a></li><li class=""><a href="/neon-js/docs/en/api/index.html" target="_self">API</a></li><li class=""><a href="/neon-js/docs/en/changelog/latest.html" target="_self">Changelog</a></li><li class=""><a href="/neon-js/en/help.html" target="_self">Help</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/installation.html">Installation</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/structure.html">Structure</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/guides/basic/sendasset.html">Basic - Sending assets</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/guides/basic/claimgas.html">Basic - Claiming Gas</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/guides/basic/createscript.html">Basic - Create Smart Contract Script</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/neon-js/docs/en/guides/basic/doinvoke.html">Basic - Invoking a Smart Contract</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/guides/basic/privnet.html">Basic - Using a Private Net</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/guides/basic/multi.html">Basic - Signing with a multi-sig account</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/guides/adv/multitx.html">Advanced - Sending multiple transactions in a block</a></li><li class="navListItem"><a class="navItem" href="/neon-js/docs/en/guides/adv/apicore.html">Advanced - API Core Components</a></li></ul></div></div></section></div><script>
            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Basic - Invoking a Smart Contract</h1></header><article><div><span><p>This is a guide to use the <code>doInvoke</code> method.If you have read <code>Basic - Sending Assets</code>, then this should feel familiar.</p>
<p>An Invocation Transaction is the transaction used to invoke a smart contract. Invocation of a smart contract will trigger the execution of a smart contract and persist any changes in the blockchain itself.</p>
<p>In this example, we will use the most commonly invoked scenario: An NEP5 token transfer.</p>
<pre><code class="hljs css language-js"><span class="hljs-comment">// import Neon, { api, wallet } from "@cityofzion/neon-js";</span>
<span class="hljs-keyword">const</span> { <span class="hljs-attr">default</span>: Neon, api, wallet, sc, nep5 } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"@cityofzion/neon-js"</span>);

<span class="hljs-keyword">const</span> sendingKey =
  <span class="hljs-string">"9ab7e154840daca3a2efadaf0df93cd3a5b51768c632f5433f86909d9b994a69"</span>;
<span class="hljs-keyword">const</span> receivingAddress = <span class="hljs-string">"ALq7AWrhAueN6mJNqk6FHJjnsEoPRytLdW"</span>;
<span class="hljs-keyword">const</span> contractScriptHash = <span class="hljs-string">"5b7074e873973a6ed3708862f219a6fbf4d1c411"</span>;
<span class="hljs-keyword">const</span> numOfDecimals = <span class="hljs-number">8</span>;
<span class="hljs-keyword">const</span> amtToSend = <span class="hljs-number">1</span>;
<span class="hljs-keyword">const</span> network = <span class="hljs-string">"TestNet"</span>;
<span class="hljs-keyword">const</span> additionalInvocationGas = <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> additionalIntents = [];
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="selecting-the-api-provider-and-network"></a><a href="#selecting-the-api-provider-and-network" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Selecting the API provider and network</h2>
<p>Like in <code>sendAsset</code>, we establish the network we are interacting with through the selection of a API provider.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> apiProvider = <span class="hljs-keyword">new</span> api.neoscan.instance(<span class="hljs-string">"TestNet"</span>);

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"\n\n--- API Provider ---"</span>);
<span class="hljs-built_in">console</span>.log(apiProvider);
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="creating-the-account"></a><a href="#creating-the-account" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating the Account</h2>
<p>Similar to <code>sendAsset</code>, we are using an Account object to encapsulate our private key.</p>
<p>This account will be the account to claim gas from.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> account = <span class="hljs-keyword">new</span> wallet.Account(sendingKey);

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"\n\n--- Sending Address ---"</span>);
<span class="hljs-built_in">console</span>.log(account);
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="creating-the-invocation-script"></a><a href="#creating-the-invocation-script" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating the Invocation Script</h2>
<p>A smart contract is actually just a function with an arbitrary number of arguments.
However, the convention established in NEO is for smart contracts to always have the default signature of <code>(string operation, byte[] args)</code>.
Our tooling will be built for such smart contracts.</p>
<p>We will be making use of the <code>neon-nep5</code> package to help us generate the invocation script:</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> generator = nep5.abi.transfer(contractScriptHash, account.address, receivingAddress, amtToSend * numOfDecimals)
<span class="hljs-keyword">const</span> builder = generator();
<span class="hljs-keyword">const</span> script = builder.str;
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="attaching-invocation-fees"></a><a href="#attaching-invocation-fees" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Attaching invocation fees</h2>
<p>Running the code of a smart contract takes up CPU cycles. Thus, there must be some form of payment for the time taken to run the smart contract.
The blockchain currently gives 10 free GAS for each invocation transaction. If more GAS is required for the invocation, you may attach additional GAS.</p>
<blockquote>
<p>You can only attach GAS in integers. You may not attach 0.1, 1.1 or 123.456 GAS.</p>
</blockquote>
<p>In this example, we will be attaching 0 fees but will be showing you how to attach it.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> gas = additionalInvocationGas;
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="additional-intents"></a><a href="#additional-intents" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Additional Intents</h2>
<p>It is possible to attach additional assets for the Invocation Transaction. This is important in some scenarios where you want the movement of assets to be also involved with the running of the smart contract.</p>
<p>For example, in an ICO, the <code>mintTokens</code> method will be called with an Invocation Transaction with assets being transferred to the ICO contract. In this manner, the invocation will be ran with the information of the asset transfer available to the running of the smart contract.</p>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> intent = additionalIntents;
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="execute"></a><a href="#execute" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Execute</h2>
<p>We assemble the config object and doInvoke will do the following:</p>
<ol>
<li>Retrieve the balance of sendingKey from apiProvider.</li>
<li>Retrieve a good rpc url from apiProvider.</li>
<li>Assemble the transaction using the balance, intents and gas.</li>
<li>Attach the script to the transaction.</li>
<li>Sign the transaction using the sendingKey</li>
<li>Submit the transaction to the network using the <code>sendrawtransaction</code> RPC call to the rpc url.</li>
</ol>
<pre><code class="hljs css language-js"><span class="hljs-keyword">const</span> config = {
  <span class="hljs-attr">api</span>: apiProvider, <span class="hljs-comment">// The API Provider that we rely on for balance and rpc information</span>
  account: account, <span class="hljs-comment">// The sending Account</span>
  intents: intent, <span class="hljs-comment">// Additional intents to move assets</span>
  script: script, <span class="hljs-comment">// The Smart Contract invocation script</span>
  gas: gas <span class="hljs-comment">// Additional GAS for invocation.</span>
};

Neon.doInvoke(config)
  .then(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"\n\n--- Response ---"</span>);
    <span class="hljs-built_in">console</span>.log(config.response);
  })
  .catch(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
    <span class="hljs-built_in">console</span>.log(config);
  });
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="about-asset-less-transactions"></a><a href="#about-asset-less-transactions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>About asset-less transactions</h2>
<p>Currently, the fees for transactions are zero, making it possible for us to send transactions that are without any assets attached to them. This is done through attaching an extra <code>Script</code> attribute. The value of this attribute is the scripthash of your address. This ties the transaction to an address so that the node knows who the signature came from.</p>
<p>However, you will realise that without transaction inputs, it results in the possibility of collisions for transactions hashes. This is solved by attaching a nonce in the form of a remark. In <code>neon-js</code>, the <code>doInvoke</code> method detects if there are no assets attached and inserts the nonce. This nonce is crafted using a random hexstring with the current timestamp.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/neon-js/docs/en/guides/basic/createscript.html"><span class="arrow-prev">← </span><span>Basic - Create Smart Contract Script</span></a><a class="docs-next button" href="/neon-js/docs/en/guides/basic/privnet.html"><span>Basic - Using a Private Net</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#selecting-the-api-provider-and-network">Selecting the API provider and network</a></li><li><a href="#creating-the-account">Creating the Account</a></li><li><a href="#creating-the-invocation-script">Creating the Invocation Script</a></li><li><a href="#attaching-invocation-fees">Attaching invocation fees</a></li><li><a href="#additional-intents">Additional Intents</a></li><li><a href="#execute">Execute</a></li><li><a href="#about-asset-less-transactions">About asset-less transactions</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/neon-js/" class="nav-home"><img src="/neon-js/img/logo.svg" alt="neon-js" width="66" height="58"/></a><div><h5>Docs</h5><a href="/neon-js/docs/en/installation.html">Getting Started</a><a href="/neon-js/docs/en/guides/basic/sendasset.html">Guides</a><a href="/neon-js/docs/en/api/index.html">API Reference</a></div><div><h5>Community</h5><a href="https://discord.gg/wczVXTN">Discord Chat</a><a href="https://www.reddit.com/r/NEO/" target="_blank">NEO Reddit</a></div><div><h5>More</h5><a href="https://neo.org/" target="_blank">NEO</a><a href="https://github.com/cityofzion/neon-js" target="_blank">GitHub</a><a class="github-button" href="https://github.com/cityofzion/neon-js" data-icon="octicon-star" data-count-href="/cityofzion/neon-js/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="http://cityofzion.io" target="_blank" class="fbOpenSource"><img src="/neon-js/img/coz_med.png" alt="City of Zion" width="150" height="150"/></a><section class="copyright">Copyright © 2018 City of Zion</section></footer></div></body></html>